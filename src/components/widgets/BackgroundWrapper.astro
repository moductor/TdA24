---
import BackgroundBlob from "./BackgroundBlob.astro";

type Props = {
  [prop: string]: any;
};
---

<div {...Astro.props}>
  <slot />
  <span class="background" data-background-wrapper>
    <BackgroundBlob data-background-wrapper-blob />
    <BackgroundBlob data-background-wrapper-blob />
    <span class="white-glow" data-background-wrapper-glow></span>
  </span>
</div>

<style lang="scss">
  div {
    position: relative;
    isolation: isolate;
  }

  .white-glow {
    display: block;
    aspect-ratio: 1;
    background-color: var(--color-white);
    border-radius: 50%;
    filter: blur(30rem);
    opacity: 0.1;
  }

  .background {
    position: absolute;
    inset: 0;
    z-index: -1;
    overflow: clip;
  }

  .background > * {
    position: absolute;
  }

  .background > :nth-child(1) {
    width: max(16%, 18rem);
    rotate: -45deg;
    top: -12rem;
    left: -4rem;
  }

  .background > :nth-child(2) {
    width: max(18%, 20rem);
    rotate: -45deg;
    top: 24rem;
    right: -8rem;
  }

  .background > :nth-child(3) {
    width: max(60%, 64rem);
    top: 8rem;
    left: 50%;
    translate: -50% 0;
    z-index: -1;
  }
</style>

<script>
  const maxMove = 0.06;

  const attribure = "data-background-wrapper";
  const backgrounds = document.querySelectorAll(`[${attribure}]`);

  document.addEventListener("mousemove", (e) => {
    const mq = window.matchMedia("(prefers-reduced-motion: reduce)");
    if (mq.matches) return;

    for (const background of backgrounds) {
      for (const _element of background.children) {
        const element = _element as HTMLElement;
        const boundingbox = element.getBoundingClientRect();

        const centerX = boundingbox.x + boundingbox.width / 2;
        const centerY = boundingbox.y + boundingbox.height / 2;

        const offsetX = e.clientX - centerX;
        const offsetY = e.clientY - centerY;

        const maxMoveX = boundingbox.width * maxMove;
        const maxMoveY = boundingbox.height * maxMove;

        const relOffsetX = offsetX * (maxMoveX / window.innerWidth);
        const relOffsetY = offsetY * (maxMoveY / window.innerHeight);

        const ratioX = relOffsetX / boundingbox.width;
        const ratioY = relOffsetY / boundingbox.height;

        const transformX = ratioX * 100;
        const transformY = ratioY * 100;

        element.style.transform = `translate(${transformX}%, ${transformY}%)`;
      }
    }
  });
</script>
